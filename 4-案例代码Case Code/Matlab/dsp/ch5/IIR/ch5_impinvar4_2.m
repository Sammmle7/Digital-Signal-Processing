% Zhou Zhiguo
% 2019.5.1
% Ch5 数字滤波器设计
% 脉冲响应不变变换法---impinvar 
% 说明：（1）模拟滤波器设计---简化计算过程
% 说明：（2）模拟滤波器设计采用buttord_z

clear; 
close all;
clc;

%--------------------------------------------------------------------------
% P194 教学demo
% 采用脉冲响应不变变换法，设计数字巴特沃斯滤波器
% 通带 Wp = 0.2*pi     1dB
% 阻带 Ws = 0.3~1*pi   15dB
% 求：N,H(z),H(ejw),直接-I
%--------------------------------------------------------------------------
T = 1;
fs = 1;
Wp = 0.2*pi; 
Ws = 0.3*pi;
Ap = 1;     %dB
As = 15;    %dB
[N,Wc] = buttord_z(Wp,Ws,Ap,As,'s'); 

[z,p,k] = buttap(N);          % Butterworth filter prototype
%p = 
%    -0.2588 + 0.9659i
%    -0.2588 - 0.9659i
%    -0.7071 + 0.7071i
%    -0.7071 - 0.7071i
%    -0.9659 + 0.2588i
%    -0.9659 - 0.2588i

%个人经验：
% [z,p,k] = buttap(N);              求得零极点，但这个零极点是归一化的； 
% [num,den] = zp2tf(z,p,k);         求分子，分母系数前，零极点需要去归一化；
p = p*Wc;  
k = k*(Wc^N);
% p =
%   -0.1820 + 0.6792i
%   -0.1820 - 0.6792i
%   -0.4972 + 0.4972i
%   -0.4972 - 0.4972i
%   -0.6792 + 0.1820i
%   -0.6792 - 0.1820i

% k = 0.1209

[num,den] = zp2tf(z,p,k);     % Convert to transfer function form
%num = 0         0         0         0         0         0         0.1209
%den = 1.0000    2.7170    3.6910    3.1788    1.8252    0.6644    0.1209

hs = tf(num,den);
zpk(hs);
% hs =
%                                   0.1209
%   -----------------------------------------------------------------------
%   s^6 + 2.717 s^5 + 3.691 s^4 + 3.179 s^3 + 1.825 s^2 + 0.6644 s + 0.1209 
pzmap(hs);

%--------------------------------------------------------------------------
%部分分式展开
%--------------------------------------------------------------------------
Bs = num;%分子
As = den;%分母
[r,p,k] = residue(Bs,As);
disp(r);
disp(p);
disp(k);

% 留数
% r =
%   -1.0714 + 0.0000i
%   -1.0714 - 0.0000i
%    0.1435 + 0.2486i
%    0.1435 - 0.2486i
%    0.9279 - 1.6071i
%    0.9279 + 1.6071i
% 极点  
%  p =
%   -0.4972 + 0.4972i
%   -0.4972 - 0.4972i
%   -0.1820 + 0.6792i
%   -0.1820 - 0.6792i
%   -0.6792 + 0.1820i
%   -0.6792 - 0.1820i

% hs =
%       0.9279 - 1.6071i             0.9279 + 1.6071i
%   ------------------------  +  ------------------------- 
%    s-(-0.6792 + 0.1820i)         s-(-0.6792 - 0.1820i)
% +
%       0.1435 + 0.2486i             0.1435 - 0.2486i
%   ------------------------  +  ------------------------- 
%    s-(-0.1820 + 0.6792i)         s-(-0.1820 - 0.6792i)
% +
%       -1.0714 + 0.0000i             -1.0714 - 0.0000i
%   ------------------------  +  ------------------------- 
%    s-(-0.4972 + 0.4972i)         s-(-0.4972 - 0.4972i)
